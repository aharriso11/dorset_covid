filter(la_type=="L" | la_type=="MD" | la_type=="SC" | la_type=="UA") %>%
filter(la_name!="LONDON BOROUGHS" | la_name!="METROPOLITAN DISTRICTS" | la_name!="UNITARY AUTHORITIES" | la_name!="SHIRE COUNTIES")
la_rev_data_socialcare <- la_rev_data_socialcare %>%
filter(la_type=="L" | la_type=="MD" | la_type=="SC" | la_type=="UA") %>%
filter(la_name=="LONDON BOROUGHS") %>%
filter(la_name=="METROPOLITAN DISTRICTS") %>%
filter(la_name=="UNITARY AUTHORITIES") %>%
filter(la_name=="SHIRE COUNTIES")
la_rev_data_socialcare <- subset(la_rev_data_raw, select = c("...3", "...4", "...5", "330", "360"))
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "...3"] <- "la_name"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "...4"] <- "la_mys"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "...5"] <- "la_type"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "330"] <- "children"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "360"] <- "adult"
la_rev_data_socialcare <- la_rev_data_socialcare %>%
filter(la_type=="L" | la_type=="MD" | la_type=="SC" | la_type=="UA") %>%
filter(la_name!="LONDON BOROUGHS") %>%
filter(la_name!="METROPOLITAN DISTRICTS") %>%
filter(la_name!="UNITARY AUTHORITIES") %>%
filter(la_name!="SHIRE COUNTIES")
la_rev_data_socialcare <- subset(la_rev_data_raw, select = c("...3", "...5", "330", "360"))
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "...3"] <- "la_name"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "...5"] <- "la_type"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "330"] <- "children"
names(la_rev_data_socialcare)[names(la_rev_data_socialcare) == "360"] <- "adult"
la_rev_data_socialcare <- la_rev_data_socialcare %>%
filter(la_type=="L" | la_type=="MD" | la_type=="SC" | la_type=="UA") %>%
filter(la_name!="LONDON BOROUGHS") %>%
filter(la_name!="METROPOLITAN DISTRICTS") %>%
filter(la_name!="UNITARY AUTHORITIES") %>%
filter(la_name!="SHIRE COUNTIES")
la_rev_data_socialcare_long <- gather(la_rev_data_socialcare, spend_type, total, children, adult)
View(la_rev_data_socialcare_long)
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = la_name, y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, value), y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = la_name, y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
warnings()
head(la_rev_data_socialcare_long)
class(la_rev_data_socialcare_long$total)
la_rev_data_socialcare_long$total <- as.numeric(as.character(la_rev_data_socialcare_long$total))
class(la_rev_data_socialcare_long$total)
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(breaks = c(100000, 200000, 300000, 400000, 500000)) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(breaks = c(100000, 200000, 300000, 400000, 500000), labels = scales::dollar()) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(breaks = c(100000, 200000, 300000, 400000, 500000), labels = comma) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(breaks = c(100000, 200000, 300000, 400000, 500000), labels = scales::comma()) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
options(scipen = 999) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
options(scipen = 999) +
facet_grid( ~ spend_type) +
theme_bw()
rlang::last_error()
rlang::last_trace()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
#  options(scipen = 999) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
options(scipen = 999) +
facet_grid( ~ spend_type) +
theme_bw()
# Use pacman to install (if req) and load required packages
pacman::p_load(
readxl,
tidyr,
ggplot2,
dplyr,
zoo,
data.table,
scales
)
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend", labels = comma) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare_long, aes(x = reorder(la_name, total), y = total, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
#  facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
la_rev_data_socialcare$adult <- as.numeric(as.character(la_rev_data_socialcare$adult))
la_rev_data_socialcare$children <- as.numeric(as.character(la_rev_data_socialcare$children))
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
#  facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_x_continuous(name = "Local authority") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
#  facet_grid( ~ spend_type) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
#  facet_grid( ~ spend_type) +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
#  facet_grid( ~ spend_type) +
theme(axis.text.x=element_text(angle=90,hjust=1)) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority")
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme(axis.text.x=element_text(angle=90,hjust=1)) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
theme_bw()
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1,size = 2))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1,size = 3))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1,size = 4))
socialcare_plot
theme(axis.text.x=element_text(angle=45,hjust=1,size = 5)
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1,size=4))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority") +
#  facet_grid( ~ spend_type) +
theme_bw() +
theme(axis.text.x=element_text(angle=60,hjust=1,size=5))
socialcare_plot
highlight = function(x, pat, color="black", family="") {
ifelse(grepl(pat, x), glue("<b style='font-family:{family}; color:{color}'>{x}</b>"), x)
}
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red")) +
theme_bw() +
theme(axis.text.x=element_text(angle=60,hjust=1,size=5))
socialcare_plot
# Use pacman to install (if req) and load required packages
pacman::p_load(
readxl,
tidyr,
ggplot2,
dplyr,
zoo,
data.table,
scales,
glue
)
highlight = function(x, pat, color="black", family="") {
ifelse(grepl(pat, x), glue("<b style='font-family:{family}; color:{color}'>{x}</b>"), x)
}
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red")) +
theme_bw() +
theme(axis.text.x=element_text(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red")) +
theme_bw() +
theme(axis.text.x=element_html(angle=60,hjust=1,size=5))
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
# Use pacman to install (if req) and load required packages
pacman::p_load(
readxl,
tidyr,
ggplot2,
dplyr,
zoo,
data.table,
scales,
glue,
ggtext
)
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red4")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red3")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red3")) +
scale_fill_discrete(name = "LA type", labels = c("London borough", "Metropolitan district", "County", "Unitary authority")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red3")) +
scale_fill_discrete(name = "LA type", labels = c("London borough", "Metropolitan district", "County council", "Unitary authority")) +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red3")) +
scale_fill_discrete(name = "LA type", labels = c("London borough", "Metropolitan district", "County council", "Unitary authority")) +
ggtitle("Local authority adult social services spend 2020-21") +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
socialcare_plot <- ggplot() +
geom_bar(data = la_rev_data_socialcare, aes(x = reorder(la_name, adult), y = adult, fill = la_type), stat = "identity") +
scale_y_continuous(name = "Spend £thousand", labels = comma) +
scale_x_discrete(name = "Local authority", labels= function(x) highlight(x, "Dorset UA|Bournemouth, Christchurch and Poole UA", "red3")) +
scale_fill_discrete(name = "LA type", labels = c("London borough", "Metropolitan district", "County council", "Unitary authority")) +
ggtitle("Local authority adult social services spend 2020-21", subtitle = "Data from https://www.gov.uk/government/collections/local-authority-revenue-expenditure-and-financing") +
theme_bw() +
theme(axis.text.x=element_markdown(angle=60,hjust=1,size=5))
socialcare_plot
# set working directory
setwd("~/Documents/GitHub/dorset_covid")
# install the UKHSA covid-19 R SDK
remotes::install_github("publichealthengland/coronavirus-dashboard-api-R-sdk")
library(ukcovid19)
# Install the pacman package to call all the other packages
if (!require("pacman")) install.packages("pacman")
# Use pacman to install (if req) and load required packages
pacman::p_load(
httr,
readxl,
readODS,
tidyverse,
zoo,
data.table,
scales,
glue,
ggtext,
ggthemes,
pals,
utils,
reshape,
lubridate,
rvest,
stringr,
openxlsx,
ggalt,
fuzzyjoin
)
# query filter for England
filter_eng <- c(
'areaType=nation',
'areaCode=E92000001'
)
# query filter for SW
filter_rsw <-c(
'areaType=nhsRegion',
'areaCode=E40000006'
)
# query filter for RBD
filter_rbd <-c(
'areaType=nhsTrust',
'areaCode=RBD'
)
# query filter for R0D
filter_r0d <-c(
'areaType=nhsTrust',
'areaCode=R0D'
)
# data structure for the API call
df_structure <- c(date = "date",
areaName = "areaName",
areaCode = "areaCode",
hospitalCases = "hospitalCases",
newAdmissions = 'newAdmissions'
)
# England
df_eng <- get_data(
filters = filter_eng,
structure = df_structure
)
# south west
df_rsw <- get_data(
filters = filter_rsw,
structure = df_structure
)
# dorset county hospital
df_rbd <- get_data(
filters = filter_rbd,
structure = df_structure
)
# university hospitals dorset
df_r0d <- get_data(
filters = filter_r0d,
structure = df_structure
)
# waves dataframe - as a tibble to allow use with fuzzy_join below
df_waves <- tibble(
start = c(as.Date(c("2020-03-01")), as.Date(c("2020-09-01")), as.Date(c("2021-05-01"))),
end = c(as.Date(c("2020-08-31")), as.Date(c("2021-04-30")), as.Date(today())),
Wave = c("Wave 1", "Wave 2", "Wave 3")
)
# merge datasets into one
# 1 - place datasets into a single list
df_list <- list(df_eng, df_rsw, df_rbd, df_r0d)
# 2 - merge the datasets in the list into vaccs_combined
df_combined <- merge_recurse(df_list)
# define the date format
df_combined$date = as.Date(df_combined$date, "%Y-%m-%d")
# calculate averages
df_combined <- df_combined %>%
group_by(areaCode) %>%
mutate(hospitalCasesA = rollmean(hospitalCases, k = 7, fill = NA)) %>%
mutate(newAdmissionsA = rollmean(newAdmissions, k = 7, fill = NA))
# convert to tibble to permit the fuzzy join below
as_tibble(df_combined)
# use fuzzy join to lookup the date for each observation against the date ranges in df_waves
df_combined <- fuzzy_left_join(
df_combined, df_waves,
by = c(
"date" = "start",
"date" = "end"
),
match_fun = list(`>=`, `<=`)
) %>%
select(areaCode, areaType, areaName, date, hospitalCasesA, newAdmissionsA, Wave)
df_combined <- df_combined %>%
filter(!is.na(newAdmissionsA) & !is.na(hospitalCasesA))
df_latest <- df_combined %>%
group_by(areaCode) %>%
slice(which.max(date))
df_plot <- ggplot() +
# main data
geom_point(data = df_combined, aes(x = newAdmissionsA, y = hospitalCasesA, colour = Wave), shape = 1, size = 2) +
# latest data (black spot)
geom_point(data = df_latest, aes(x = newAdmissionsA, y = hospitalCasesA), colour = "black", shape = 16, size = 2) +
# faceting
facet_wrap( ~ areaName, scales = "free") +
# scale colours
scale_colour_manual(name = "Wave", values = c("Wave 1" = "red", "Wave 2" = "blue", "Wave 3" = "limegreen")) +
# axis settings
xlab("New admissions to hospital with covid-19") +
ylab("Cases of people in hospital with covid-19") +
# set title and subtitle
ggtitle("Comparing covid hospital admissions with cases in hospital") +
labs(caption = paste("Data from the UK Health Security Agency. Plotted", Sys.time(), sep = " ", "\nData plot by Andrew Harrison / https://aharriso11.github.io/dorset_covid, and inspired by @bristoliver"),
subtitle = "The daily number of new admissions to hospital of patients with covid-19, compared with the daily number of confirmed covid-19 patients in hospital.<br>
If the black dot goes up, the number of people in hospital with covid-19 is rising. If the black dot moves to the right, the number of people being admitted to hospital with covid-19 is rising.<br>
<b><span style='color:red;'>Wave 1</span></b> ran from 1st March 2020 to 31st August 2020. <b><span style='color:blue;'>Wave 2</span></b> ran from 1st September 2020 to 30th April 2021. <b><span style='color:limegreen;'>Wave 3</span></b> began on 1st May 2021 and is the current wave."
) +
# set theme and customisations
theme_base() +
theme(
axis.text.x = element_text(size = 8),
axis.text.y = element_text(size = 8),
plot.title = element_text(size = 20, family = "Helvetica", face = "bold"),
plot.subtitle = element_markdown(hjust = 0, vjust = 0, size = 11),
plot.caption = element_text(size = 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 10),
legend.background = element_blank(),
legend.box.background = element_rect(colour = "black"),
axis.title = element_text(size = 12),
axis.text = element_text(size = 8),
strip.text.y = element_text(size = 9.5),
strip.text.x = element_text(size = 9.5, face = "bold"))
# run plot
df_plot
